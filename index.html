<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DARKSS Slot v0.0.3</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* –°–¢–ò–õ–ò DARKSS */
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { background-color: #050505; color: #fff; font-family: 'Orbitron', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: space-between; height: 100vh; margin: 0; padding: 10px 0 20px 0; overflow: hidden; position: relative; }
        .retro-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, #000000 0%, #1a0b2e 100%); z-index: -2; }
        .header { text-align: center; margin-bottom: 5px; z-index: 2; }
        .version { font-size: 8px; color: #555; position: absolute; top: 5px; left: 5px;}
        .title-neon { font-size: 32px; font-weight: 900; letter-spacing: 3px; color: #fff; text-shadow: 0 0 10px #bc13fe, 0 0 20px #bc13fe; margin: 0; }
        .subtitle { font-size: 10px; color: #00ffff; letter-spacing: 4px; margin-top: 2px; }
        .slots-wrapper { display: flex; gap: 10px; padding: 15px; background: rgba(10, 10, 10, 0.85); border: 2px solid #bc13fe; border-radius: 15px; box-shadow: 0 0 40px rgba(188, 19, 254, 0.2); z-index: 2; margin-top: 10px; }
        .reel { width: 85px; height: 130px; background: #000; border: 2px solid #00ffff; border-radius: 8px; overflow: hidden; position: relative; }
        .reel-strip { display: flex; flex-direction: column; position: absolute; top: 0; left: 0; width: 100%; transition: transform 0.4s cubic-bezier(0.1, 1, 0.5, 1); }
        .reel-strip div { height: 130px; display: flex; align-items: center; justify-content: center; font-size: 55px; }
        .spinning .reel-strip { filter: blur(3px); transition: none !important; }
        .result-symbol { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: none; align-items: center; justify-content: center; font-size: 60px; filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
        .result-symbol.active { display: flex; animation: bounceIn 0.4s; }
        @keyframes bounceIn { 0% { transform: scale(0.5); opacity: 0; } 70% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); } }
        .controls { width: 95%; max-width: 400px; background: rgba(15, 15, 15, 0.95); border-top: 2px solid #00ffff; border-radius: 20px 20px 0 0; padding: 20px; display: flex; flex-direction: column; gap: 15px; box-shadow: 0 -5px 30px rgba(0, 255, 255, 0.15); z-index: 2; margin-top: auto; }
        .info-row { display: flex; justify-content: space-between; align-items: center; background: #000; padding: 8px 15px; border-radius: 8px; border: 1px solid #333; }
        .info-label { font-size: 9px; color: #888; letter-spacing: 1px; }
        .info-value { font-size: 16px; color: #bc13fe; text-shadow: 0 0 5px rgba(188, 19, 254, 0.5); }
        .buttons-row { display: flex; gap: 8px; height: 55px; }
        .bet-control { display: flex; align-items: center; justify-content: space-between; background: #111; border: 1px solid #333; border-radius: 10px; width: 110px; padding: 0 5px; }
        .bet-btn { background: #222; color: #00ffff; border: none; width: 30px; height: 30px; border-radius: 6px; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .bet-display { display: flex; flex-direction: column; align-items: center; width: 40px; }
        .bet-label { font-size: 8px; color: #666; }
        .bet-num { font-size: 14px; color: #fff; font-weight: bold; }
        .btn-spin { flex-grow: 1; border: none; border-radius: 10px; background: linear-gradient(135deg, #bc13fe 0%, #7a00cc 100%); color: #fff; font-size: 20px; letter-spacing: 2px; font-family: 'Orbitron', sans-serif; font-weight: 900; cursor: pointer; box-shadow: 0 0 15px rgba(188, 19, 254, 0.4); transition: transform 0.1s; }
        .paytable { width: 95%; max-width: 400px; background: rgba(10, 10, 10, 0.9); border: 1px solid #7a00cc; border-radius: 10px; padding: 10px; margin-top: 10px; z-index: 2; }
        .paytable h4 { font-size: 14px; text-align: center; color: #00ffff; margin: 0 0 8px 0; }
        .paytable table { width: 100%; font-size: 12px; text-align: center; color: #ccc; }
        #demoBadge { display: none; position: absolute; top: 10px; right: 10px; background: #ff0000; color: white; padding: 4px 10px; border-radius: 4px; font-size: 10px; font-weight: bold; z-index: 100; }
    </style>
</head>
<body>
    <div class="version">v0.0.3</div>

    <div class="retro-bg"></div>
    <div id="demoBadge">DEMO</div>

    <div class="header">
        <h1 class="title-neon">DARKSS</h1>
        <div class="subtitle">CASINO SYSTEM</div>
    </div>

    <div class="slots-wrapper">
        <div class="reel" id="reel-1"><div class="reel-strip" id="strip-1"></div><div class="result-symbol" id="result-1">‚ö°</div></div>
        <div class="reel" id="reel-2"><div class="reel-strip" id="strip-2"></div><div class="result-symbol" id="result-2">‚ö°</div></div>
        <div class="reel" id="reel-3"><div class="reel-strip" id="strip-3"></div><div class="result-symbol" id="result-3">‚ö°</div></div>
    </div>

    <div class="paytable">
        <h4>–¢–ê–ë–õ–ò–¶–ê –í–´–ü–õ–ê–¢</h4>
        <table><tr><td>üåô üß≠ üö¢ ü¶â (x2)</td><td>‚ö° (x5)</td><td>üíé (x10)</td><td>7Ô∏è‚É£ (x20)</td></tr></table>
    </div>

    <div class="controls">
        <div class="info-row">
            <div>
                <div class="info-label">–í–ê–® –ë–ê–õ–ê–ù–°</div>
                <div class="info-value"><span id="balanceDisplay">...</span> –ë–ê–ë–û–ö</div>
            </div>
            <div style="text-align: right;">
                <div class="info-label">–°–¢–ê–¢–£–°</div>
                <div class="info-value" id="statusText" style="font-size: 11px; color: #fff;">–ó–ê–ì–†–£–ó–ö–ê...</div>
            </div>
        </div>

        <div class="buttons-row">
            <div class="bet-control">
                <button class="bet-btn" onclick="changeBet(-10)">-</button>
                <div class="bet-display"><span class="bet-label">BET</span><span class="bet-num" id="betAmountDisplay">100</span></div>
                <button class="bet-btn" onclick="changeBet(10)">+</button>
            </div>
            <button class="btn-spin" id="spinButton" onclick="startSpin()">SPIN</button>
        </div>
    </div>

    <script>
        const symbols = ['üåô', 'üß≠', 'üö¢', '‚ö°', 'ü¶â', 'üíé', '7Ô∏è‚É£'];
        const reelSymbolsCount = 30; const symbolHeight = 130;
        let currentBet = 100; const minBet = 10; const maxBet = 1000;
        let isSpinning = false; let isDemoMode = false;
        
        const strips = [document.getElementById('strip-1'), document.getElementById('strip-2'), document.getElementById('strip-3')];
        const resultSymbols = [document.getElementById('result-1'), document.getElementById('result-2'), document.getElementById('result-3')];
        const balanceDisplay = document.getElementById('balanceDisplay');
        const statusText = document.getElementById('statusText');

        function getStartParam() {
            const unsafe = Telegram.WebApp.initDataUnsafe;
            if (unsafe && unsafe.start_param) return unsafe.start_param;
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('start_param');
        }

        function checkEnvironment() {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();

            const rawParam = getStartParam();

            if (rawParam) {
                try {
                    const data = JSON.parse(decodeURIComponent(rawParam));
                    if (data.balance !== undefined) {
                        balanceDisplay.textContent = data.balance;
                        statusText.textContent = "–ì–û–¢–û–í (v0.0.3)";
                        statusText.style.color = "#00ff00";
                    }
                } catch (e) {
                    statusText.textContent = "–û–®–ò–ë–ö–ê –î–ê–ù–ù–´–•";
                }
            } else {
                if (!Telegram.WebApp.initData) {
                    isDemoMode = true;
                    document.getElementById('demoBadge').style.display = 'block';
                    balanceDisplay.textContent = '1000';
                    statusText.textContent = "DEMO (–ë–†–ê–£–ó–ï–†)";
                } else {
                    statusText.textContent = "–ó–ê–ü–£–°–¢–ò–¢–ï –ß–ï–†–ï–ó –ë–û–¢–ê";
                    statusText.style.color = "red";
                    balanceDisplay.textContent = "0";
                }
            }
            initializeStrips();
        }

        function initializeStrips() {
            strips.forEach(strip => {
                strip.innerHTML = '';
                for (let i = 0; i < reelSymbolsCount; i++) {
                    const div = document.createElement('div');
                    div.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                    strip.appendChild(div);
                }
                strip.style.transform = `translateY(${-symbolHeight * (reelSymbolsCount - 1)}px)`;
            });
            resultSymbols.forEach(el => el.classList.add('active'));
        }

        function changeBet(amount) {
            if (isSpinning) return;
            let newBet = currentBet + amount;
            if (newBet >= minBet && newBet <= maxBet) {
                currentBet = newBet;
                document.getElementById('betAmountDisplay').textContent = currentBet;
            }
        }

        function startSpin() {
            if (isSpinning) return;
            let bal = parseInt(balanceDisplay.textContent);
            
            if (bal < currentBet && !isDemoMode) { 
                statusText.textContent = "–ù–ï–¢ –°–†–ï–î–°–¢–í";
                statusText.style.color = "red";
                return; 
            }

            isSpinning = true;
            document.getElementById('spinButton').disabled = true;
            statusText.textContent = "–ö–†–£–¢–ò–ú...";
            statusText.style.color = "#fff";
            
            // –í–∏–∑—É–∞–ª—å–Ω–æ —Å–ø–∏—Å—ã–≤–∞–µ–º –¥–µ–Ω—å–≥–∏
            balanceDisplay.textContent = bal - currentBet;

            resultSymbols.forEach(el => el.classList.remove('active'));
            strips.forEach(strip => {
                strip.classList.add('spinning');
                strip.style.transform = `translateY(0)`;
                let y = 0;
                strip.dataset.interval = setInterval(() => {
                    y -= symbolHeight; if (y <= -(reelSymbolsCount * symbolHeight)) y = 0;
                    strip.style.transform = `translateY(${y}px)`;
                }, 50);
            });

            // –ñ–¥–µ–º 2.5 —Å–µ–∫—É–Ω–¥—ã, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é, –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º
            setTimeout(stopSpinAndSend, 2500);
        }

        function stopSpinAndSend() {
            // 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–∏–º–≤–æ–ª–∞—Ö
            const final = [
                symbols[Math.floor(Math.random() * symbols.length)],
                symbols[Math.floor(Math.random() * symbols.length)],
                symbols[Math.floor(Math.random() * symbols.length)]
            ];

            strips.forEach((strip, i) => {
                clearInterval(strip.dataset.interval);
                strip.classList.remove('spinning');
                const idx = symbols.indexOf(final[i]);
                const pos = (5 * symbols.length) + idx; 
                strip.style.transform = `translateY(${-pos * symbolHeight}px)`;
                
                setTimeout(() => {
                    resultSymbols[i].textContent = final[i];
                    resultSymbols[i].classList.add('active');
                }, 400);
            });

            setTimeout(() => {
                isSpinning = false;
                document.getElementById('spinButton').disabled = false;
                
                if (isDemoMode) {
                    statusText.textContent = "DEMO –ó–ê–í–ï–†–®–ï–ù–û";
                } else {
                    statusText.textContent = "–°–ú–û–¢–†–ò–¢–ï –í –ß–ê–¢–ï! (–ó–∞–∫—Ä—ã—Ç–∏–µ WebApp)";
                    
                    // 2. –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–ê–Ø –û–¢–ü–†–ê–í–ö–ê –î–ê–ù–ù–´–• –ò –ó–ê–ö–†–´–¢–ò–ï
                    const data = { action: 'SPIN', bet: currentBet };
                    Telegram.WebApp.sendData(JSON.stringify(data));
                }
            }, 1000);
        }

        checkEnvironment();
    </script>
</body>
</html>
