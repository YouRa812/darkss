<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DARKSS Slot Machine</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* === 1. –ì–õ–û–ë–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò === */
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: #050505; color: #fff; font-family: 'Orbitron', sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: space-between;
            height: 100vh; margin: 0; padding: 10px 0 20px 0; overflow: hidden; position: relative;
        }

        /* === 2. –ê–ù–ò–ú–ò–†–û–í–ê–ù–ù–´–ô –§–û–ù (CYBERPUNK GRID) === */
        .retro-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, #000000 0%, #1a0b2e 100%); z-index: -2;
        }
        .grid-plane {
            position: absolute; bottom: -30%; left: -50%; width: 200%; height: 100%;
            background-image: 
                linear-gradient(rgba(188, 19, 254, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(188, 19, 254, 0.3) 1px, transparent 1px);
            background-size: 40px 40px; transform: perspective(500px) rotateX(60deg);
            animation: moveGrid 1s linear infinite; z-index: -1;
            box-shadow: 0 -50px 100px rgba(188, 19, 254, 0.2);
        }
        @keyframes moveGrid { 0% { background-position: 0 0; } 100% { background-position: 0 40px; } }

        /* === 3. –î–ï–ú–û –ü–õ–ê–®–ö–ê === */
        .demo-badge {
            display: none; position: absolute; top: 10px; right: 10px;
            background: #ff0000; color: white; padding: 4px 10px; border-radius: 4px;
            font-size: 10px; font-weight: bold; z-index: 100;
        }

        /* === 4. –ó–ê–ì–û–õ–û–í–û–ö === */
        .header { text-align: center; margin-bottom: 5px; z-index: 2; }
        .title-neon { font-size: 32px; font-weight: 900; letter-spacing: 3px; color: #fff; text-shadow: 0 0 10px #bc13fe, 0 0 20px #bc13fe; margin: 0; }
        .subtitle { font-size: 10px; color: #00ffff; letter-spacing: 4px; margin-top: 2px; }

        /* === 5. –°–õ–û–¢–´ */
        .slots-wrapper {
            display: flex; gap: 10px; padding: 15px;
            background: rgba(10, 10, 10, 0.85); border: 2px solid #bc13fe; border-radius: 15px;
            box-shadow: 0 0 40px rgba(188, 19, 254, 0.2); z-index: 2; margin-top: 10px;
        }
        .reel {
            width: 85px; height: 130px; background: #000; border: 2px solid #00ffff;
            border-radius: 8px; overflow: hidden; position: relative;
        }
        
        /* –ü–æ–ª–æ—Å–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        .reel-strip { 
            display: flex; 
            flex-direction: column; 
            position: absolute;
            top: 0; left: 0; width: 100%;
            transition: transform 0.4s cubic-bezier(0.1, 1, 0.5, 1);
            opacity: 1;
        }
        .reel-strip div { 
            height: 130px; display: flex; align-items: center; justify-content: center; 
            font-size: 55px; 
        }
        
        /* –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Ä–∞—â–µ–Ω–∏—è */
        .spinning .reel-strip { 
            transition: none !important;
            filter: blur(3px);
            opacity: 1; 
        }
        
        /* –°–∏–º–≤–æ–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
        .result-symbol {
            width: 100%; height: 100%; position: absolute; top: 0; left: 0;
            display: none; align-items: center; justify-content: center;
            font-size: 60px; filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
        }
        .result-symbol.active {
            display: flex;
            animation: bounceIn 0.4s;
        }
        @keyframes bounceIn { 0% { transform: scale(0.5); opacity: 0; } 70% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); } }

        /* === 6. –¢–ê–ë–õ–ò–¶–ê –í–´–ü–õ–ê–¢ === */
        .paytable {
            width: 95%; max-width: 400px; background: rgba(10, 10, 10, 0.9); border: 1px solid #7a00cc;
            border-radius: 10px; padding: 10px; margin-top: 10px; z-index: 2;
        }
        .paytable h4 { font-size: 14px; text-align: center; color: #00ffff; text-shadow: 0 0 5px #00ffff; margin: 0 0 8px 0; letter-spacing: 2px; }
        .paytable table { width: 100%; border-collapse: collapse; font-size: 12px; text-align: center; }
        .paytable th, .paytable td { padding: 5px; border-bottom: 1px solid rgba(188, 19, 254, 0.3); }
        .paytable th { color: #bc13fe; font-weight: bold; font-size: 11px; text-transform: uppercase; }
        .paytable td { color: #ccc; }
        .paytable .symbol-row { font-size: 20px; }
        .paytable .multiplier { color: #fff; font-weight: bold; text-shadow: 0 0 3px #00ffff; }

        /* === 7. –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø === */
        .controls {
            width: 95%; max-width: 400px; background: rgba(15, 15, 15, 0.95);
            border-top: 2px solid #00ffff; border-radius: 20px 20px 0 0; padding: 20px;
            display: flex; flex-direction: column; gap: 15px; box-shadow: 0 -5px 30px rgba(0, 255, 255, 0.15);
            z-index: 2; margin-top: auto;
        }
        .info-row { display: flex; justify-content: space-between; align-items: center; background: #000; padding: 8px 15px; border-radius: 8px; border: 1px solid #333; }
        .info-label { font-size: 9px; color: #888; letter-spacing: 1px; }
        .info-value { font-size: 16px; color: #bc13fe; text-shadow: 0 0 5px rgba(188, 19, 254, 0.5); }
        .buttons-row { display: flex; gap: 8px; height: 55px; }
        .bet-control { display: flex; align-items: center; justify-content: space-between; background: #111; border: 1px solid #333; border-radius: 10px; width: 110px; padding: 0 5px; }
        .bet-btn { background: #222; color: #00ffff; border: none; width: 30px; height: 30px; border-radius: 6px; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .bet-display { display: flex; flex-direction: column; align-items: center; width: 40px; }
        .bet-label { font-size: 8px; color: #666; }
        .bet-num { font-size: 14px; color: #fff; font-weight: bold; }
        .btn-spin { flex-grow: 1; border: none; border-radius: 10px; background: linear-gradient(135deg, #bc13fe 0%, #7a00cc 100%); color: #fff; font-size: 20px; letter-spacing: 2px; font-family: 'Orbitron', sans-serif; font-weight: 900; cursor: pointer; box-shadow: 0 0 15px rgba(188, 19, 254, 0.4); transition: transform 0.1s; }
        .btn-topup { width: 50px; background: #111; border: 1px solid #00ffff; border-radius: 10px; color: #00ffff; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* === 8. –ú–û–î–ê–õ–ö–ê === */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center;
            z-index: 2000; opacity: 0; transition: opacity 0.3s;
        }
        .modal {
            background: #111; border: 2px solid #bc13fe; padding: 25px; border-radius: 15px;
            text-align: center; width: 85%; box-shadow: 0 0 30px rgba(188, 19, 254, 0.2);
            transform: scale(0.9); transition: transform 0.3s;
        }
        .modal h3 { color: #bc13fe; margin-top: 0; }
        .modal p { color: #ccc; font-size: 13px; line-height: 1.4; }
        .btn-close {
            margin-top: 15px; padding: 8px 25px; background: transparent; border: 1px solid #00ffff;
            color: #00ffff; border-radius: 20px; font-family: 'Orbitron', sans-serif; cursor: pointer;
        }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-overlay.active .modal { transform: scale(1); }
    </style>
</head>
<body>

    <div class="retro-bg"></div>
    <div class="grid-plane"></div>

    <div id="demoBadge" class="demo-badge">DEMO</div>

    <div class="header">
        <h1 class="title-neon">DARKSS</h1>
        <div class="subtitle">CASINO SYSTEM</div>
    </div>

    <div class="slots-wrapper">
        <div class="reel" id="reel-1">
            <div class="reel-strip" id="strip-1"></div>
            <div class="result-symbol" id="result-1">‚ö°</div>
        </div>
        <div class="reel" id="reel-2">
            <div class="reel-strip" id="strip-2"></div>
            <div class="result-symbol" id="result-2">‚ö°</div>
        </div>
        <div class="reel" id="reel-3">
            <div class="reel-strip" id="strip-3"></div>
            <div class="result-symbol" id="result-3">‚ö°</div>
        </div>
    </div>

    <div class="paytable">
        <h4>–¢–ê–ë–õ–ò–¶–ê –í–´–ü–õ–ê–¢ (x –°—Ç–∞–≤–∫–∞)</h4>
        <table>
            <thead>
                <tr>
                    <th>–°–ò–ú–í–û–õ (3x)</th>
                    <th>–ö–û–≠–§–§–ò–¶–ò–ï–ù–¢</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="symbol-row">üåô üß≠ üö¢ ü¶â</td>
                    <td class="multiplier">x2</td>
                </tr>
                <tr>
                    <td class="symbol-row">‚ö°</td>
                    <td class="multiplier">x5</td>
                </tr>
                <tr>
                    <td class="symbol-row">üíé</td>
                    <td class="multiplier">x10</td>
                </tr>
                <tr>
                    <td class="symbol-row">7Ô∏è‚É£</td>
                    <td class="multiplier">x20</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="controls">
        <div class="info-row">
            <div>
                <div class="info-label">–í–ê–® –ë–ê–õ–ê–ù–°</div>
                <div class="info-value"><span id="balanceDisplay">0</span> –ë–ê–ë–û–ö</div>
            </div>
            <div style="text-align: right;">
                <div class="info-label">–°–¢–ê–¢–£–°</div>
                <div class="info-value" id="statusText" style="font-size: 11px; color: #fff;">–ì–û–¢–û–í</div>
            </div>
        </div>

        <div class="buttons-row">
            <div class="bet-control">
                <button class="bet-btn" onclick="changeBet(-10)">-</button>
                <div class="bet-display">
                    <span class="bet-label">BET</span>
                    <span class="bet-num" id="betAmountDisplay">100</span>
                </div>
                <button class="bet-btn" onclick="changeBet(10)">+</button>
            </div>

            <button class="btn-spin" id="spinButton" onclick="startSpin()">SPIN</button>
            <button class="btn-topup" onclick="openModal()">+</button>
        </div>
    </div>

    <div class="modal-overlay" id="topupModal">
        <div class="modal">
            <h3>–ü–û–ü–û–õ–ù–ï–ù–ò–ï</h3>
            <p>–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.</p>
            <p style="color: #00ffff">–°–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–æ–º –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –ë–∞–±–æ–∫.</p>
            <button class="btn-close" onclick="closeModal()">OK</button>
        </div>
    </div>

    <script>
        const symbols = ['üåô', 'üß≠', 'üö¢', '‚ö°', 'ü¶â', 'üíé', '7Ô∏è‚É£']; 
        const reelSymbolsCount = 30; 
        const symbolHeight = 130; 
        
        let currentBet = 100;
        const minBet = 10;
        const maxBet = 1000;
        
        // –ö–∞—Ä—Ç–∞ –≤—ã–ø–ª–∞—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ DEMO-—Ä–µ–∂–∏–º–∞
        const payoutMap = {
            'üåô': 2, 'üß≠': 2, 'üö¢': 2, 'ü¶â': 2, 
            '‚ö°': 5,
            'üíé': 10,
            '7Ô∏è‚É£': 20
        };

        const reels = [
            document.getElementById('reel-1'),
            document.getElementById('reel-2'),
            document.getElementById('reel-3')
        ];
        const strips = [
            document.getElementById('strip-1'),
            document.getElementById('strip-2'),
            document.getElementById('strip-3')
        ];
        const resultSymbols = [
            document.getElementById('result-1'),
            document.getElementById('result-2'),
            document.getElementById('result-3')
        ];

        const balanceDisplay = document.getElementById('balanceDisplay');
        const betDisplay = document.getElementById('betAmountDisplay');
        const statusText = document.getElementById('statusText');
        const spinButton = document.getElementById('spinButton');
        const modal = document.getElementById('topupModal');
        const demoBadge = document.getElementById('demoBadge');
        
        let isDemoMode = false;
        let isSpinning = false;
        let spinIntervals = [];
        let currentUserId = null; 

        // === –ö–û–ù–°–¢–ê–ù–¢–´ –°–ö–û–†–û–°–¢–ò ===
        const SPIN_DURATION = 1000; 
        const STOP_DELAY = 250;     
        const SLOWDOWN_TIME = 400;  


        // --- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò: –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–ê–†–°–ò–ù–ì –î–ê–ù–ù–´–• –û–¢ –ë–û–¢–ê ---
        function parseInitData() {
            if (!Telegram.WebApp.initData) return null;
            
            // 1. –ò—Å–ø–æ–ª—å–∑—É–µ–º initData –¥–ª—è –ø–æ–∏—Å–∫–∞ start_param
            const urlParams = new URLSearchParams(Telegram.WebApp.initData);
            const startParam = urlParams.get('start_param');
            
            if (startParam) {
                try {
                    // 2. –î–µ–∫–æ–¥–∏—Ä—É–µ–º –∏ –ø–∞—Ä—Å–∏–º JSON-–æ–±—ä–µ–∫—Ç
                    const decodedJson = decodeURIComponent(startParam);
                    return JSON.parse(decodedJson); 
                } catch (e) {
                    console.error("Failed to parse start_param", e);
                    // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null
                }
            }
            return null;
        }


        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø (–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–æ—Å —Å–∏–º–≤–æ–ª–∞–º–∏) ===
        function initializeStrips() {
            strips.forEach((strip) => {
                strip.innerHTML = '';
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–∏–º–≤–æ–ª—ã
                for (let i = 0; i < reelSymbolsCount; i++) {
                    const symbol = symbols[Math.floor(Math.random() * symbols.length)];
                    const div = document.createElement('div');
                    div.textContent = symbol;
                    strip.appendChild(div);
                }
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª–æ—Å—É –≤ –ø–æ–∑–∏—Ü–∏—é, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
                strip.style.transform = `translateY(${-symbolHeight * (reelSymbolsCount - 1)}px)`;
            });
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            resultSymbols.forEach(el => {
                el.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                el.classList.add('active'); 
            });
        }

        // --- –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò ---
        function checkEnvironment() {
            let initialBalance = '0';
            
            if (!Telegram.WebApp.initData) {
                // –î–µ–º–æ-—Ä–µ–∂–∏–º
                isDemoMode = true;
                demoBadge.style.display = 'block';
                initialBalance = '1000'; 
                statusText.textContent = "DEMO READY";
            } else {
                // –†–µ–∂–∏–º Telegram Web App
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();

                const data = parseInitData();
                
                if (data && data.balance !== undefined) {
                    // –£–°–ü–ï–•: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏ –±–∞–ª–∞–Ω—Å –µ—Å—Ç—å
                    initialBalance = data.balance; 
                    currentUserId = data.user_id; 
                    statusText.textContent = `–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –£–°–ü–ï–®–ù–ê. ID: ${currentUserId}`; 
                    statusText.style.color = "#00ffff";
                } else {
                    // –°–ë–û–ô: –ë–∞–ª–∞–Ω—Å –Ω–µ –Ω–∞–π–¥–µ–Ω (–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–±–æ—è)
                    const urlParams = new URLSearchParams(Telegram.WebApp.initData || '');
                    const startParam = urlParams.get('start_param');

                    if (Telegram.WebApp.initData && startParam) {
                         statusText.textContent = "–°–ë–û–ô: –û—à–∏–±–∫–∞ JSON. –ë–∞–ª–∞–Ω—Å 0.";
                         statusText.style.color = "red";
                    } else if (Telegram.WebApp.initData && !startParam) {
                         // –≠–¢–û –ë–´–õ–ê –í–ê–®–ê –ü–†–û–ë–õ–ï–ú–ê: –ë–æ—Ç –Ω–µ –ø–µ—Ä–µ–¥–∞–ª start_param –≤ URL WebApp
                         statusText.textContent = "–°–ë–û–ô: initData –µ—Å—Ç—å, start_param –ù–ï–¢. –ë–∞–ª–∞–Ω—Å 0.";
                         statusText.style.color = "red";
                    } else {
                         statusText.textContent = "–°–ë–û–ô: initData –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç. –ë–∞–ª–∞–Ω—Å 0.";
                         statusText.style.color = "red";
                    }
                }
            }
            
            balanceDisplay.textContent = initialBalance; 
            initializeStrips(); 
        }

        // === –ò–ó–ú–ï–ù–ï–ù–ò–ï –°–¢–ê–í–ö–ò ===
        function changeBet(amount) {
            if (isSpinning) return;
            let newBet = currentBet + amount;
            newBet = Math.round(newBet / 10) * 10;

            if (newBet < minBet) newBet = minBet;
            if (newBet > maxBet) newBet = maxBet;
            
            currentBet = newBet;
            betDisplay.textContent = currentBet;
        }

        // === –ú–û–î–ê–õ–ö–ê ===
        function openModal() { modal.classList.add('active'); }
        function closeModal() { modal.classList.remove('active'); }

        // === –õ–û–ì–ò–ö–ê –ê–ù–ò–ú–ê–¶–ò–ò (JS-–ö–û–ù–¢–†–û–õ–¨) ===

        function startSpin() {
            if (isSpinning) return;

            let currentBal = parseInt(balanceDisplay.textContent) || 0;
            
            if (currentBal < currentBet) {
                statusText.textContent = "–ú–ê–õ–û –ë–ê–ë–û–ö";
                statusText.style.color = "red";
                return;
            }

            isSpinning = true;
            spinButton.disabled = true;
            statusText.textContent = "–ö–†–£–¢–ò–ú...";
            statusText.style.color = "#00ffff";

            // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏–∫—É, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–æ—Å—ã
            resultSymbols.forEach(el => el.classList.remove('active'));
            strips.forEach(strip => {
                strip.classList.add('spinning'); 
                strip.style.transform = `translateY(0)`; 
            });

            // !!! –í–ê–ñ–ù–û: –ú—ã –Ω–µ –º–µ–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –∑–¥–µ—Å—å. –≠–¢–û –î–ï–õ–ê–ï–¢ –¢–û–õ–¨–ö–û –ë–≠–ö–ï–ù–î !!!
            // balanceDisplay.textContent = currentBal - currentBet; // –£–î–ê–õ–ï–ù–û –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

            // 1. –ó–∞–ø—É—Å–∫–∞–µ–º –±—ã—Å—Ç—Ä—É—é JS –ø—Ä–æ–∫—Ä—É—Ç–∫—É –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–ª–æ—Å—ã
            spinIntervals = strips.map((strip) => {
                let currentY = 0;
                
                return setInterval(() => {
                    currentY -= symbolHeight; 
                    if (currentY <= - (reelSymbolsCount * symbolHeight)) {
                        currentY = 0;
                    }
                    strip.style.transform = `translateY(${currentY}px)`;
                }, 50); 
            });

            // 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ SPIN_DURATION
            setTimeout(() => determineResult(), SPIN_DURATION);
        }

        function determineResult() {
            // !!! –î–ê–ù–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø –¢–û–õ–¨–ö–û –î–õ–Ø –í–ò–ó–£–ê–õ–ê !!!
            // –§–ò–ù–ê–ù–°–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –û–ü–†–ï–î–ï–õ–Ø–ï–¢ –ë–≠–ö–ï–ù–î
            const isVisualWin = Math.random() < 0.3; // –ß–∏—Å—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–π —à–∞–Ω—Å
            let finalSymbols = [];
            let payoutData = 0; // –î–ª—è Demo Mode

            if (isVisualWin) {
                // –ï—Å–ª–∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à, –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Å–∏–º–≤–æ–ª –∏–∑ –≤—ã–∏–≥—Ä—ã—à–Ω—ã—Ö
                const winSymbols = ['‚ö°', 'üíé', '7Ô∏è‚É£'];
                const sym = winSymbols[Math.floor(Math.random() * winSymbols.length)];
                finalSymbols = [sym, sym, sym];
                payoutData = currentBet * payoutMap[sym];
            } else {
                // –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–∏–≥—Ä—ã—à
                finalSymbols = [
                    symbols[Math.floor(Math.random() * symbols.length)],
                    symbols[Math.floor(Math.random() * symbols.length)],
                    symbols[Math.floor(Math.random() * symbols.length)]
                ];
            }

            // 3. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞—Ä–∞–±–∞–Ω—ã —Å —É–º–µ–Ω—å—à–µ–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
            stopReel(0, finalSymbols[0]);
            setTimeout(() => stopReel(1, finalSymbols[1]), STOP_DELAY);
            setTimeout(() => stopReel(2, finalSymbols[2]), STOP_DELAY * 2);

            // –§–∏–Ω–∞–ª
            setTimeout(() => {
                isSpinning = false;
                spinButton.disabled = false;

                if (isDemoMode) {
                    let currentBal = parseInt(balanceDisplay.textContent);
                    if (isVisualWin) {
                        statusText.textContent = `DEMO WIN! (x${payoutMap[finalSymbols[0]]})`;
                        // –í Demo Mode –æ–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
                        balanceDisplay.textContent = currentBal - currentBet + payoutData;
                    } else {
                        statusText.textContent = "DEMO LOSE";
                        // –í Demo Mode —Å–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
                        balanceDisplay.textContent = currentBal - currentBet;
                    }
                } else {
                    // –í —Ä–µ–∂–∏–º–µ Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç–∞–≤–∫—É
                    statusText.textContent = "–û–ñ–ò–î–ê–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–ê –ë–û–¢–ê...";
                    sendToBot();
                }
            }, SPIN_DURATION + (STOP_DELAY * 2) + SLOWDOWN_TIME + 100); 
        }

        function stopReel(index, targetSymbol) {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∞–Ω–∏–º–∞—Ü–∏—é –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å–∏–º–≤–æ–ª
            clearInterval(spinIntervals[index]);
            const strip = strips[index];
            const resultEl = resultSymbols[index];
            const targetIndex = symbols.indexOf(targetSymbol);
            
            const numCycles = Math.floor(Math.random() * 5) + 5; 
            const landingSpot = numCycles * symbols.length; 
            
            const finalPositionIndex = (landingSpot + targetIndex);
            const finalShiftY = -finalPositionIndex * symbolHeight;

            strip.classList.remove('spinning'); 
            strip.style.transform = `translateY(${finalShiftY}px)`;

            setTimeout(() => {
                resultEl.textContent = targetSymbol;
                resultEl.classList.add('active'); 
            }, SLOWDOWN_TIME); 
        }


        function sendToBot() {
            if (isDemoMode) return;
            const dataToSend = {
                action: 'SPIN', // <--- –û–¢–ü–†–ê–í–õ–Ø–ï–ú –¢–û–õ–¨–ö–û –î–ï–ô–°–¢–í–ò–ï
                bet: currentBet // <--- –û–¢–ü–†–ê–í–õ–Ø–ï–ú –¢–û–õ–¨–ö–û –°–¢–ê–í–ö–£
            };
            Telegram.WebApp.sendData(JSON.stringify(dataToSend));
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        checkEnvironment();

    </script>
</body>
</html>
